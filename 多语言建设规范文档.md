# Next.js 多语言开发标准流程 (SOP)

本规范基于 **Next.js App Router** 和 **next-intl** 库。

## 1. 核心原则

1.  **静态文本分离**：代码中严禁出现硬编码的文字（如 "Contact Us"），必须使用 Key（如 `t('contact')`）。
2.  **文件结构隔离**：
    *   业务页面放在 `src/app/[locale]/` 下。
    *   通用配置放在 `src/app/` 根目录。
3.  **配置一次性**：`i18n.ts` 和 `middleware.ts` 配置好后通常无需改动。

---

## 2. 翻译工作流：当你面对一个新页面

假设你要翻译一个新的页面（例如：`/services` 服务页），请严格按照以下步骤操作：

### 第一步：提取文本 (Extraction)

打开该页面的组件文件（如 `src/components/ServicesList.tsx`），找到所有**硬编码的英文字符串**。

*   **Before (硬编码):**
    ```tsx
    <h2>Our Services</h2>
    <p>We provide comprehensive OEM solutions.</p>
    ```

### 第二步：定义翻译 Key (Definition)

打开 `src/messages/en.json` 和 `src/messages/zh.json`，在对应的组件命名空间下添加 Key。
*建议按组件名称作为顶层 Key，保持结构清晰。*

**`src/messages/en.json`**
```json
{
  "ServicesList": {
    "title": "Our Services",
    "description": "We provide comprehensive OEM solutions."
  }
}
```

**`src/messages/zh.json`**
```json
{
  "ServicesList": {
    "title": "我们的服务",
    "description": "我们提供全面的 OEM 解决方案。"
  }
}
```

### 第三步：组件接入 (Implementation)

在组件中引入 `useTranslations` Hook 并替换文本。

*   **After (多语言):**
    ```tsx
    import { useTranslations } from 'next-intl';

    export function ServicesList() {
      // 1. 初始化 Hook，传入顶层 Key（Namespace，即组件名）
      const t = useTranslations('ServicesList');

      return (
        <div>
          {/* 2. 使用 t() 函数替换文本 */}
          <h2>{t('title')}</h2>
          <p>{t('description')}</p>
        </div>
      );
    }
    ```

---

## 3. 区分：静态文本 vs 动态数据

在翻译时，请务必区分这两种内容：

*   **静态文本（写在 JSON 里）**：
    *   页面标题、副标题
    *   按钮文字（"Read More", "Submit"）
    *   表单标签（"Email", "Name"）
    *   固定的宣传语（Slogan）
    *   *处理方式：按上述步骤 1-3 操作。*

*   **动态数据（**不需要**写在 JSON 里）**：
    *   产品名称、产品描述
    *   新闻标题、新闻内容
    *   具体的技术参数
    *   *处理方式：这些数据通常来自 Strapi 后端。只需在调用 API 时带上 `locale` 参数即可（例如：`/api/products?locale=zh`）。不需要前端 JSON 翻译。*

---

## 4. 高级用法备忘

### 动态参数
如果文本中包含变量（如 "Hello, {name}"）。
*   JSON: `"greeting": "Hello, {name}"`
*   Code: `t('greeting', { name: 'John' })`

### 富文本
如果文本中包含 HTML 标签（如 `<b>`）。
*   Code: `t.rich('content', { b: (chunks) => <b>{chunks}</b> })`

### 服务端组件 (Server Components)
在 `async` Server Component（通常是 `page.tsx`）中，使用 `getTranslations` 而不是 `useTranslations`。
```tsx
import { getTranslations } from 'next-intl/server';

export default async function Page() {
  const t = await getTranslations('Page');
  return <h1>{t('title')}</h1>;
}
```

---

## 5. 常见问题排查 Checklist

如果页面出现 404 或翻译不显示，请按顺序检查：

1.  **文件名检查**：`messages/zh.json` 文件名是否正确？JSON 格式是否合法？
2.  **Key 路径检查**：`t('title')` 对应的 Key 在 JSON 中是否存在？嵌套层级是否正确？
3.  **路由检查**：URL 是否包含语言前缀？（如 `/zh/products`）。
4.  **缓存清理**：如果修改了 `i18n.ts` 或 `middleware.ts`，务必重启服务器：
    ```bash
    rm -rf .next && npm run dev
    ```
